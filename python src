import os
import ssl
import xmlrpc.client

# ===== ENV proměnné =====
odoo_url = os.environ["ODOO_URL"]
odoo_db = os.environ["ODOO_DB"]
odoo_user = os.environ["ODOO_USER"]
odoo_password = os.environ["ODOO_PASSWORD"]

# ===== SSL context (pokud není validní cert) =====
ssl_context = ssl._create_unverified_context()

# ===== Auth endpoint =====
common = xmlrpc.client.ServerProxy(
    f"{odoo_url}/xmlrpc/2/common",
    context=ssl_context
)

uid = common.authenticate(
    odoo_db,
    odoo_user,
    odoo_password,
    {}
)

if not uid:
    raise RuntimeError("❌ Přihlášení do Odoo selhalo")

print(f"✅ Přihlášení do Odoo OK (uid={uid})")

# ===== Object endpoint =====
models = xmlrpc.client.ServerProxy(
    f"{odoo_url}/xmlrpc/2/object",
    context=ssl_context
)

print("✅ Odoo XML-RPC klient připravený")
